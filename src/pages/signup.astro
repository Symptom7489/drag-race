---
import { sql } from '../lib/db';

if (Astro.request.method === "POST") {
  const data = await Astro.request.formData();
  const user = data.get("username");
  const pass = data.get("password");

  try {
    await sql`INSERT INTO users (username, password_hash) VALUES (${user}, ${pass})`;
    return Astro.redirect('/login');
  } catch (e) {
    var error = "Username already taken!";
  }
}
---
<form method="POST">
  <h1>Join the League</h1>
  {error && <p style="color:red">{error}</p>}
  <input name="username" placeholder="Username" required />
  <input name="password" type="password" placeholder="Password" required />
  <button type="submit">Sign Up</button>
</form>