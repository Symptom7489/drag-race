---
import { sql } from '../lib/db';

let error = null;

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const user = data.get("username");
    const pass = data.get("password");

    if (user && pass) {
      await sql`INSERT INTO users (username, password_hash) VALUES (${user}, ${pass})`;
      // Change this to your main dashboard or login page
      return Astro.redirect('/'); 
    }
  } catch (e) {
    console.error(e);
    error = "Could not create account. " + e.message;
  }
}
---
<form method="POST">
  <h1>Join the League</h1>
  {error && <p style="color:red">{error}</p>}
  <input name="username" placeholder="Username" required />
  <input name="password" type="password" placeholder="Password" required />
  <button type="submit">Sign Up</button>
</form>